var num=0;function isEmpty(e){return void 0===e||null==e||""==e}String.prototype.startWith=function(e){return new RegExp("^"+e).test(this)},String.prototype.endWith=function(e){return new RegExp(e+"$").test(this)},$(document).ready(function(){$("#formCheck-urldecode").prop("checked",!0),$("#response-result").hide(),$.get("/api/ver",function(e,t){$("#version").html("GoFileProxy v"+e.version)}),$("#formCheck-filename").change(function(){$(this).prop("checked")?$("#custom-filename").show():$("#custom-filename").hide()}),$("#formCheck-cookies").change(function(){$(this).prop("checked")?$("#custom-cookie").show():$("#custom-cookie").hide()}),$("#formCheck-header").change(function(){$(this).prop("checked")?$("#custom-header").show():$("#custom-header").hide()}),$("#custom-header-add").click(function(){var e=$("#custom-header > .input-group"),t='<div class="input-group"><div class="input-group-prepend"><span class="input-group-text">自定义请求头</span></div><input class="form-control header-key" type="text" placeholder="请输入Key"><input class="form-control header-value" type="text" placeholder="请输入Value"><div class="input-group-append"><button class="btn btn-danger" type="button" onclick="customHeaderDelete('+num+++')">删除</button></div></div>';e.last().after(t)}),customHeaderDelete=function(e){$('#custom-header > .input-group [onclick="customHeaderDelete('+e+')"]').parent().parent().remove()},headerData2Json=function(){var e=[];return $("#custom-header > .input-group").each(function(){var t=$(this).children(".header-key").val(),r=$(this).children(".header-value").val(),o={};isEmpty(t)||isEmpty(r)||(o[t]=r,e.push(o))}),JSON.stringify(e)},getToken=function(e,t,r,o,a){var i={};i.url=e,i.verify=$("#verify-value").val(),isEmpty(t)||(i.filename=t),isEmpty(r)||(i.cookie=r),isEmpty(o)||"[]"==o||(i.headers=o),i.urldecode=$("#fromCheck-urldecode").prop("checked"),$.ajax({url:"/api/token/generate",type:"POST",data:JSON.stringify(i),async:!1,success:function(e){0!=e.code?a.error(e.message):a.success(e)},error:function(e){a.error("服务器内部错误")}})},$("#verify-img").click(function(){$("#verify-img").attr("src","/api/captcha/image?_="+(new Date).getTime())}),$("#btn-go").click(function(){var e=$("#input-url").val();""!=e&&"http://"!=e&&"https://"!=e?e.startsWith("http://")||e.startsWith("https://")?($("#verify-img").attr("src","/api/captcha/image?_="+(new Date).getTime()),$("#verify-value").val(""),$("#modal-captcha").modal("show")):myalert('请输入正确的URL！ URL以 "http://" 或 "https://" 开头'):myalert("请输入URL！")}),$("#btn-submit").click(function(){if(4==$("#verify-value").val().length){$("#modal-captcha").modal("hide");var e,t=$("#input-url").val(),r="";if($("#formCheck-filename").prop("checked"))isEmpty(e=$("#input-name").val())?($("#formCheck-filename").prop("checked",!1),$("#formCheck-filename").trigger("change")):r=e;if($("#formCheck-cookies").prop("checked"))isEmpty(e=$("#input-cookie").val())?($("#formCheck-cookies").prop("checked",!1),$("#formCheck-cookies").trigger("change")):e;if($("#formCheck-header").prop("checked")){var o=headerData2Json();isEmpty(o)||"[]"==o?($("#formCheck-header").prop("checked",!1),$("#formCheck-header").trigger("change")):o}getToken(t,r,$("#input-cookie").val(),headerData2Json(),{success:function(e){$("#response-result").show();var t=window.location.protocol+"//"+window.location.host+"/api/stream/"+e.token,r=e.data.FileName;console.log("fn -> "+r),$("#result-url").attr("href",t),$("#result-url").text(t),ts2Date=function(e){return d=new Date(1e3*e),d.toLocaleDateString().replace(/\//g,"-")+" "+d.toTimeString().substr(0,8)},$("#result-create").text(ts2Date(e.data.generate_timestamp)),$("#result-expire").text(ts2Date(e.data.expire_timestamp)),$("#response-alert").hide(),$("#link-goto-response").trigger("click"),setTimeout(function(){$("#response-box").removeClass("animated"),$("#response-box").addClass("animated"),$("#response-box").removeClass("bounce"),$("#response-box").addClass("bounce")},1e3)},error:function(e){myalert(e)}})}else alert("验证码长度必须为4位")}),$("#link-goto-response").click(function(){return $("html, body").animate({scrollTop:$($.attr(this,"href")).offset().top},500),!1}),myalert=function(e){$("#alert-string").html(e),$("#modal-alert").modal("show")}});